(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["MobileMessaging"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["MobileMessaging"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,n){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="plugins/MobileMessaging/vue/dist/",n(n.s="fae3")}({"19dc":function(t,n){t.exports=e},"8bbf":function(e,n){e.exports=t},a5a2:function(e,t){e.exports=n},fae3:function(e,t,n){"use strict";if(n.r(t),n.d(t,"ReportParameters",(function(){return M})),n.d(t,"ManageSmsProvider",(function(){return T})),n.d(t,"SmsProviderCredentials",(function(){return F})),n.d(t,"DelegateMobileMessagingSettings",(function(){return R})),n.d(t,"ManageMobilePhoneNumbers",(function(){return ve})),n.d(t,"SelectPhoneNumbers",(function(){return j})),n.d(t,"AdminPage",(function(){return Pe})),"undefined"!==typeof window){var o=window.document.currentScript,r=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(n.p=r[1])}var i=n("8bbf");const a={key:0};function l(e,t,n,o,r,l){const s=Object(i["resolveComponent"])("SelectPhoneNumbers");return e.report&&"mobile"===e.report.type?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",a,[Object(i["createVNode"])(s,{"phone-numbers":e.phoneNumbers,"with-introduction":!0,"model-value":e.report.phoneNumbers,"onUpdate:modelValue":t[0]||(t[0]=t=>e.$emit("change","phoneNumbers",t))},null,8,["phone-numbers","model-value"])])):Object(i["createCommentVNode"])("",!0)}const s={class:"mobile"},c={id:"mobilePhoneNumbersHelp",class:"inline-help-node"},d=Object(i["createElementVNode"])("span",{class:"icon-info",style:{"margin-right":"3.5px"}},null,-1),u={key:0,style:{"margin-right":"3.5px"}},m={key:1,style:{"margin-right":"3.5px"}},b=["href"];function p(e,t,n,o,r,a){const l=Object(i["resolveComponent"])("Field");return Object(i["openBlock"])(),Object(i["createElementBlock"])("div",s,[Object(i["createVNode"])(l,{uicontrol:"checkbox","var-type":"array",name:"phoneNumbers","model-value":e.modelValue,"onUpdate:modelValue":t[0]||(t[0]=t=>e.$emit("update:modelValue",t)),introduction:e.withIntroduction?e.translate("ScheduledReports_SendReportTo"):void 0,title:e.translate("MobileMessaging_PhoneNumbers"),disabled:0===e.phoneNumbers.length,options:e.phoneNumbers},{"inline-help":Object(i["withCtx"])(()=>[Object(i["createElementVNode"])("div",c,[d,0===e.phoneNumbers.length?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",u,Object(i["toDisplayString"])(e.translate("MobileMessaging_MobileReport_NoPhoneNumbers")),1)):(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",m,Object(i["toDisplayString"])(e.translate("MobileMessaging_MobileReport_AdditionalPhoneNumbers")),1)),Object(i["createElementVNode"])("a",{href:e.linkTo({module:"MobileMessaging",action:"index",updated:null})},Object(i["toDisplayString"])(e.translate("MobileMessaging_MobileReport_MobileMessagingSettingsLink")),9,b)])]),_:1},8,["model-value","introduction","title","disabled","options"])])}var g=n("19dc"),h=n("a5a2"),v=Object(i["defineComponent"])({props:{modelValue:Array,phoneNumbers:{type:[Array,Object],required:!0},withIntroduction:Boolean},emits:["update:modelValue"],components:{Field:h["Field"]},methods:{linkTo(e){return"?"+g["MatomoUrl"].stringify(Object.assign(Object.assign({},g["MatomoUrl"].urlParsed.value),e))}}});v.render=p;var j=v;const O="mobile";var N=Object(i["defineComponent"])({props:{report:{type:Object,required:!0},phoneNumbers:{type:[Array,Object],required:!0}},components:{SelectPhoneNumbers:j},emits:["change"],created(){const{resetReportParametersFunctions:e,updateReportParametersFunctions:t,getReportParametersFunctions:n}=window;e[O]||(e[O]=e=>{e.phoneNumbers=[],e.formatmobile="sms"}),t[O]||(t[O]=e=>{null!==e&&void 0!==e&&e.parameters&&(e.parameters&&e.parameters.phoneNumbers&&(e.phoneNumbers=e.parameters.phoneNumbers),e.formatmobile="sms")}),n[O]||(n[O]=e=>{const t=e.phoneNumbers;return{phoneNumbers:t||[""]}})}});N.render=l;var M=N;const f=Object(i["createElementVNode"])("div",{id:"ajaxErrorManageSmsProviderSettings"},null,-1),S={key:0},y={key:0},C=Object(i["createElementVNode"])("br",null,null,-1),P={key:1},V=Object(i["createElementVNode"])("br",null,null,-1),A=["innerHTML"],E={key:1},_={id:"accountForm"},k=["innerHTML"];function B(e,t,n,o,r,a){const l=Object(i["resolveComponent"])("ActivityIndicator"),s=Object(i["resolveComponent"])("Field"),c=Object(i["resolveComponent"])("SmsProviderCredentials"),d=Object(i["resolveComponent"])("SaveButton"),u=Object(i["resolveDirective"])("form");return Object(i["openBlock"])(),Object(i["createElementBlock"])("div",null,[Object(i["createVNode"])(l,{loading:e.isDeletingAccount},null,8,["loading"]),f,e.credentialSupplied?(Object(i["openBlock"])(),Object(i["createElementBlock"])("p",S,[e.credentialError?(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",y,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_CredentialInvalid",e.provider)),1),C,Object(i["createTextVNode"])(" "+Object(i["toDisplayString"])(e.credentialError),1)])):(Object(i["openBlock"])(),Object(i["createElementBlock"])("span",P,Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_CredentialProvided",e.provider))+" "+Object(i["toDisplayString"])(e.creditLeft),1)),V,Object(i["createElementVNode"])("span",{innerHTML:e.$sanitize(e.updateOrDeleteAccountText),onClick:t[0]||(t[0]=t=>e.onUpdateOrDeleteClick(t))},null,8,A)])):(Object(i["openBlock"])(),Object(i["createElementBlock"])("p",E,Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_PleaseSignUp")),1)),Object(i["withDirectives"])((Object(i["openBlock"])(),Object(i["createElementBlock"])("div",_,[Object(i["createElementVNode"])("div",null,[Object(i["createVNode"])(s,{uicontrol:"select",name:"smsProviders",modelValue:e.smsProvider,"onUpdate:modelValue":t[1]||(t[1]=t=>e.smsProvider=t),title:e.translate("MobileMessaging_Settings_SMSProvider"),options:e.smsProviderOptions,value:e.provider},null,8,["modelValue","title","options","value"])]),Object(i["createVNode"])(c,{provider:e.smsProvider,modelValue:e.credentials,"onUpdate:modelValue":[t[2]||(t[2]=t=>e.credentials=t),t[3]||(t[3]=t=>{e.credentials=t})],"model-value":e.credentials},null,8,["provider","modelValue","model-value"]),Object(i["createVNode"])(d,{id:"apiAccountSubmit",disabled:!e.isUpdateAccountPossible,saving:e.isUpdatingAccount,onConfirm:t[4]||(t[4]=t=>e.updateAccount())},null,8,["disabled","saving"]),Object(i["createElementVNode"])("div",{class:"providerDescription",innerHTML:e.$sanitize(e.currentProviderDescription)},null,8,k)])),[[i["vShow"],!e.credentialSupplied||e.showAccountForm],[u]])])}const x={key:0};function w(e,t,n,o,r,a){const l=Object(i["resolveComponent"])("Field");return e.fields?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",x,[(Object(i["openBlock"])(!0),Object(i["createElementBlock"])(i["Fragment"],null,Object(i["renderList"])(e.fields,t=>{var n;return Object(i["openBlock"])(),Object(i["createBlock"])(l,{key:t.name,uicontrol:t.type,name:t.name,"model-value":null===(n=e.modelValue)||void 0===n?void 0:n[t.name],"onUpdate:modelValue":n=>e.$emit("update:modelValue",Object.assign(Object.assign({},e.modelValue),{},{[t.name]:n})),title:e.translate(t.title)},null,8,["uicontrol","name","model-value","onUpdate:modelValue","title"])}),128))])):Object(i["createCommentVNode"])("",!0)}const U=Object(i["reactive"])({});var D=Object(i["defineComponent"])({props:{provider:{type:String,required:!0},modelValue:Object},emits:["update:modelValue"],components:{Field:h["Field"]},watch:{provider(){this.$emit("update:modelValue",null),this.getCredentialFields()}},created(){this.getCredentialFields()},methods:{getCredentialFields(){U[this.provider]?this.$emit("update:modelValue",Object.fromEntries(U[this.provider].map(e=>[e.name,null]))):g["AjaxHelper"].fetch({module:"MobileMessaging",action:"getCredentialFields",provider:this.provider}).then(e=>{this.$emit("update:modelValue",Object.fromEntries(e.map(e=>[e.name,null]))),U[this.provider]=e})}},computed:{fields(){return U[this.provider]}}});D.render=w;var F=D,H=Object(i["defineComponent"])({props:{credentialSupplied:Boolean,credentialError:String,provider:String,creditLeft:[Number,String],smsProviderOptions:{type:Object,required:!0},smsProviders:{type:Object,required:!0}},components:{ActivityIndicator:g["ActivityIndicator"],Field:h["Field"],SaveButton:h["SaveButton"],SmsProviderCredentials:F},directives:{Form:h["Form"]},data(){return{isDeletingAccount:!1,isUpdatingAccount:!1,showAccountForm:!1,credentials:null,smsProvider:this.provider}},methods:{deleteApiAccount(){this.isDeletingAccount=!0,g["AjaxHelper"].fetch({method:"MobileMessaging.deleteSMSAPICredential"},{errorElement:"#ajaxErrorManageSmsProviderSettings"}).then(()=>{g["Matomo"].helper.redirect()}).finally(()=>{this.isDeletingAccount=!1})},showUpdateAccount(){this.showAccountForm=!0},updateAccount(){this.isUpdateAccountPossible&&(this.isUpdatingAccount=!0,g["AjaxHelper"].post({method:"MobileMessaging.setSMSAPICredential"},{provider:this.smsProvider,credentials:this.credentials},{errorElement:"#ajaxErrorManageSmsProviderSettings"}).then(()=>{g["Matomo"].helper.redirect()}).finally(()=>{this.isUpdatingAccount=!1}))},deleteAccount(){g["Matomo"].helper.modalConfirm("#confirmDeleteAccount",{yes:()=>{this.isDeletingAccount=!0,g["AjaxHelper"].fetch({method:"MobileMessaging.deleteSMSAPICredential"},{errorElement:"#ajaxErrorManageSmsProviderSettings"}).then(()=>{this.isDeletingAccount=!1,g["Matomo"].helper.redirect()}).finally(()=>{this.isDeletingAccount=!1})}})},onUpdateOrDeleteClick(e){const t=e.target;"displayAccountForm"===t.id?this.showUpdateAccount():"deleteAccount"===t.id&&this.deleteAccount()}},computed:{isUpdateAccountPossible(){return!!this.smsProvider&&null!==this.credentials&&Object.values(this.credentials).every(e=>!!e)},updateOrDeleteAccountText(){return Object(g["translate"])("MobileMessaging_Settings_UpdateOrDeleteAccount",'<a id="displayAccountForm">',"</a>",'<a id="deleteAccount">',"</a>")},currentProviderDescription(){return this.smsProvider&&this.smsProviders?this.smsProviders[this.smsProvider]:""}}});H.render=B;var T=H;function q(e,t,n,o,r,a){const l=Object(i["resolveComponent"])("Field"),s=Object(i["resolveComponent"])("SaveButton");return Object(i["openBlock"])(),Object(i["createElementBlock"])("div",null,[Object(i["createElementVNode"])("div",null,[Object(i["createVNode"])(l,{uicontrol:"radio",name:"delegatedManagement",title:e.translate("MobileMessaging_Settings_LetUsersManageAPICredential"),modelValue:e.enabled,"onUpdate:modelValue":t[0]||(t[0]=t=>e.enabled=t),"full-width":!0,options:e.delegateManagementOptions},null,8,["title","modelValue","options"])]),Object(i["createVNode"])(s,{onConfirm:t[1]||(t[1]=t=>e.save()),saving:e.isLoading},null,8,["saving"])])}var L=Object(i["defineComponent"])({props:{delegateManagementOptions:{type:Array,required:!0},delegatedManagement:[Number,Boolean]},components:{Field:h["Field"],SaveButton:h["SaveButton"]},data(){return{isLoading:!1,enabled:this.delegatedManagement?1:0}},methods:{save(){this.isLoading=!0,g["AjaxHelper"].post({method:"MobileMessaging.setDelegatedManagement"},{delegatedManagement:this.enabled&&"0"!==this.enabled?"true":"false"}).then(()=>{const e=g["NotificationsStore"].show({message:Object(g["translate"])("CoreAdminHome_SettingsSaveSuccess"),id:"mobileMessagingSettings",type:"transient",context:"success"});g["NotificationsStore"].scrollToNotification(e),g["Matomo"].helper.redirect()}).finally(()=>{this.isLoading=!1})}}});L.render=q;var R=L;const I={key:0},$={class:"row"},G={class:"col s12"},Y={class:"form-group row"},z={class:"col s12 m6"},J={class:"col s12 m6 form-help"},K={class:"form-group row addPhoneNumber"},Q={class:"col s12 m6"},W={class:"countryCode left"},X=Object(i["createElementVNode"])("span",{class:"countryCodeSymbol"},"+",-1),Z={class:"phoneNumber left"},ee={class:"addNumber left valign-wrapper"},te={class:"col s12 m6 form-help"},ne={id:"ajaxErrorManagePhoneNumber",ref:"errorContainer"},oe=Object(i["createElementVNode"])("div",{id:"notificationManagePhoneNumber"},null,-1),re={key:1,class:"row"},ie={class:"col s12"},ae={class:"col s12 m6"},le={class:"phoneNumber"},se=["onUpdate:modelValue","placeholder"],ce={key:0,class:"form-help col s12 m6"},de=["onClick"],ue={class:"ui-confirm",id:"confirmDeletePhoneNumber"},me=["innerHTML"],be=["value"],pe=["value"];function ge(e,t,n,o,r,a){const l=Object(i["resolveComponent"])("Field"),s=Object(i["resolveComponent"])("SaveButton"),c=Object(i["resolveComponent"])("Alert"),d=Object(i["resolveComponent"])("ActivityIndicator");return Object(i["openBlock"])(),Object(i["createElementBlock"])(i["Fragment"],null,[Object(i["createElementVNode"])("div",null,[Object(i["createElementVNode"])("p",null,Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_PhoneNumbers_Help")),1),e.isSuperUser?(Object(i["openBlock"])(),Object(i["createElementBlock"])("p",I,Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_DelegatedPhoneNumbersOnlyUsedByYou")),1)):Object(i["createCommentVNode"])("",!0),Object(i["createElementVNode"])("div",$,[Object(i["createElementVNode"])("h3",G,Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_PhoneNumbers_Add")),1)]),Object(i["createElementVNode"])("div",Y,[Object(i["createElementVNode"])("div",z,[Object(i["createElementVNode"])("div",null,[Object(i["createVNode"])(l,{uicontrol:"select",name:"countryCodeSelect",title:e.translate("MobileMessaging_Settings_SelectCountry"),modelValue:e.countryCallingCode,"onUpdate:modelValue":t[0]||(t[0]=t=>e.countryCallingCode=t),"full-width":!0,options:e.countries},null,8,["title","modelValue","options"])])]),Object(i["createElementVNode"])("div",J,Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_PhoneNumbers_CountryCode_Help")),1)]),Object(i["createElementVNode"])("div",K,[Object(i["createElementVNode"])("div",Q,[Object(i["createElementVNode"])("div",W,[X,Object(i["createElementVNode"])("div",null,[Object(i["createVNode"])(l,{uicontrol:"text",name:"countryCallingCode",title:e.translate("MobileMessaging_Settings_CountryCode"),modelValue:e.countryCallingCode,"onUpdate:modelValue":t[1]||(t[1]=t=>e.countryCallingCode=t),"full-width":!0,maxlength:4},null,8,["title","modelValue"])])]),Object(i["createElementVNode"])("div",Z,[Object(i["createElementVNode"])("div",null,[Object(i["createVNode"])(l,{uicontrol:"text",name:"newPhoneNumber",modelValue:e.newPhoneNumber,"onUpdate:modelValue":t[2]||(t[2]=t=>e.newPhoneNumber=t),title:e.translate("MobileMessaging_Settings_PhoneNumber"),"full-width":!0,maxlength:80},null,8,["modelValue","title"])])]),Object(i["createElementVNode"])("div",ee,[Object(i["createVNode"])(s,{class:"valign",disabled:!e.canAddNumber||e.isUpdatingPhoneNumbers,onConfirm:t[3]||(t[3]=t=>e.addPhoneNumber()),value:e.translate("General_Add")},null,8,["disabled","value"])]),Object(i["withDirectives"])(Object(i["createVNode"])(c,{severity:"warning",id:"suspiciousPhoneNumber"},{default:Object(i["withCtx"])(()=>[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_SuspiciousPhoneNumber","54184032")),1)]),_:1},512),[[i["vShow"],e.showSuspiciousPhoneNumber]])]),Object(i["createElementVNode"])("div",te,Object(i["toDisplayString"])(e.strHelpAddPhone),1)]),Object(i["createElementVNode"])("div",ne,null,512),oe,Object.keys(e.phoneNumbers||{}).length>0?(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",re,[Object(i["createElementVNode"])("h3",ie,Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_ManagePhoneNumbers")),1)])):Object(i["createCommentVNode"])("",!0),Object(i["createVNode"])(d,{loading:e.isUpdatingPhoneNumbers},null,8,["loading"]),(Object(i["openBlock"])(!0),Object(i["createElementBlock"])(i["Fragment"],null,Object(i["renderList"])(e.phoneNumbers||[],(t,n,o)=>(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",{class:"form-group row",key:o},[Object(i["createElementVNode"])("div",ae,[Object(i["createElementVNode"])("span",le,Object(i["toDisplayString"])(n),1),t.verified?Object(i["createCommentVNode"])("",!0):Object(i["withDirectives"])((Object(i["openBlock"])(),Object(i["createElementBlock"])("input",{key:0,type:"text",class:"verificationCode","onUpdate:modelValue":t=>e.validationCode[o]=t,placeholder:e.translate("MobileMessaging_Settings_EnterActivationCode"),style:{"margin-right":"3.5px"}},null,8,se)),[[i["vModelText"],e.validationCode[o]]]),t.verified?Object(i["createCommentVNode"])("",!0):(Object(i["openBlock"])(),Object(i["createBlock"])(s,{key:1,disabled:!e.validationCode[o]||e.isUpdatingPhoneNumbers,onConfirm:t=>e.validateActivationCode(n,o),value:e.translate("MobileMessaging_Settings_ValidatePhoneNumber")},null,8,["disabled","onConfirm","value"])),Object(i["createVNode"])(s,{disabled:e.isUpdatingPhoneNumbers,onConfirm:t=>e.removePhoneNumber(n),value:e.translate("General_Remove"),style:{"margin-left":"3.5px"}},null,8,["disabled","onConfirm","value"])]),t.verified?Object(i["createCommentVNode"])("",!0):(Object(i["openBlock"])(),Object(i["createElementBlock"])("div",ce,[Object(i["createElementVNode"])("div",null,[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_VerificationCodeJustSent"))+" ",1),Object(i["createElementVNode"])("a",{onClick:t=>e.resendVerificationCode(n,o)},Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_ResendVerification")),9,de)]),Object(i["createTextVNode"])("   ")]))]))),128))]),Object(i["createElementVNode"])("div",ue,[Object(i["createElementVNode"])("h2",{innerHTML:e.$sanitize(e.removeNumberConfirmation)},null,8,me),Object(i["createElementVNode"])("input",{type:"button",role:"yes",value:e.translate("General_Yes")},null,8,be),Object(i["createElementVNode"])("input",{type:"button",role:"no",value:e.translate("General_No")},null,8,pe)])],64)}var he=Object(i["defineComponent"])({props:{isSuperUser:Boolean,defaultCallingCode:String,countries:{type:Array,required:!0},strHelpAddPhone:{type:String,required:!0}},components:{Field:h["Field"],SaveButton:h["SaveButton"],Alert:g["Alert"],ActivityIndicator:g["ActivityIndicator"]},data(){return{isUpdatingPhoneNumbers:!1,phoneNumbers:{},countryCallingCode:this.defaultCallingCode||"",newPhoneNumber:"",validationCode:{},numberToRemove:""}},mounted(){this.updatePhoneNumbers()},methods:{validateActivationCode(e,t){if(!this.validationCode[t])return;const n=this.validationCode[t];this.isUpdatingPhoneNumbers=!0,this.clearNotifcationsAndErrorsContainer(),g["AjaxHelper"].post({method:"MobileMessaging.validatePhoneNumber"},{phoneNumber:e,verificationCode:n},{errorElement:"#ajaxErrorManagePhoneNumber"}).then(e=>{let t;if(e&&e.value){const e=Object(g["translate"])("MobileMessaging_Settings_PhoneActivated");t=g["NotificationsStore"].show({message:e,placeat:"#notificationManagePhoneNumber",context:"success",id:"MobileMessaging_ValidatePhoneNumber",type:"transient"}),this.updatePhoneNumbers()}else{const e=Object(g["translate"])("MobileMessaging_Settings_InvalidActivationCode");t=g["NotificationsStore"].show({message:e,placeat:"#notificationManagePhoneNumber",context:"error",id:"MobileMessaging_ValidatePhoneNumber",type:"transient"})}g["NotificationsStore"].scrollToNotification(t)}).finally(()=>{this.validationCode[t]="",this.isUpdatingPhoneNumbers=!1})},resendVerificationCode(e){this.isUpdatingPhoneNumbers=!0,this.clearNotifcationsAndErrorsContainer(),g["AjaxHelper"].post({method:"MobileMessaging.resendVerificationCode"},{phoneNumber:e},{errorElement:"#ajaxErrorManagePhoneNumber"}).then(()=>{const e=Object(g["translate"])("MobileMessaging_Settings_NewVerificationCodeSent"),t=g["NotificationsStore"].show({message:e,placeat:"#notificationManagePhoneNumber",context:"success",id:"MobileMessaging_ValidatePhoneNumber",type:"transient"});g["NotificationsStore"].scrollToNotification(t),this.updatePhoneNumbers()}).finally(()=>{this.isUpdatingPhoneNumbers=!1})},updatePhoneNumbers(){this.isUpdatingPhoneNumbers=!0,g["AjaxHelper"].post({method:"MobileMessaging.getPhoneNumbers"},{}).then(e=>{this.phoneNumbers=e,this.isUpdatingPhoneNumbers=!1})},removePhoneNumber(e){e&&(this.numberToRemove=e,this.clearNotifcationsAndErrorsContainer(),g["Matomo"].helper.modalConfirm("#confirmDeletePhoneNumber",{yes:()=>{this.isUpdatingPhoneNumbers=!0,g["AjaxHelper"].post({method:"MobileMessaging.removePhoneNumber"},{phoneNumber:e},{errorElement:"#ajaxErrorManagePhoneNumber"}).then(()=>{this.updatePhoneNumbers()}).finally(()=>{this.isUpdatingPhoneNumbers=!1,this.numberToRemove=""})}}))},addPhoneNumber(){const e=`+${this.countryCallingCode}${this.newPhoneNumber}`;this.canAddNumber&&e.length>1&&(this.isUpdatingPhoneNumbers=!0,this.clearNotifcationsAndErrorsContainer(),g["AjaxHelper"].post({method:"MobileMessaging.addPhoneNumber"},{phoneNumber:e},{errorElement:"#ajaxErrorManagePhoneNumber"}).then(()=>{this.updatePhoneNumbers(),this.countryCallingCode="",this.newPhoneNumber=""}).finally(()=>{this.isUpdatingPhoneNumbers=!1}))},clearNotifcationsAndErrorsContainer(){this.$refs.errorContainer.innerHTML="",g["NotificationsStore"].remove("MobileMessaging_ValidatePhoneNumber")}},computed:{showSuspiciousPhoneNumber(){return 0===this.newPhoneNumber.trim().lastIndexOf("0",0)},canAddNumber(){return!!this.newPhoneNumber&&""!==this.newPhoneNumber},removeNumberConfirmation(){return Object(g["translate"])("MobileMessaging_ConfirmRemovePhoneNumber",this.numberToRemove)}}});he.render=ge;var ve=he;const je={class:"manageMobileMessagingSettings"},Oe={key:0},Ne={key:0},Me={class:"ui-confirm",id:"confirmDeleteAccount"},fe=["value"],Se=["value"];function ye(e,t,n,o,r,a){const l=Object(i["resolveComponent"])("DelegateMobileMessagingSettings"),s=Object(i["resolveComponent"])("ContentBlock"),c=Object(i["resolveComponent"])("ManageSmsProvider"),d=Object(i["resolveComponent"])("ManageMobilePhoneNumbers");return Object(i["openBlock"])(),Object(i["createElementBlock"])("div",je,[e.isSuperUser?(Object(i["openBlock"])(),Object(i["createBlock"])(s,{key:0,"content-title":e.translate("MobileMessaging_SettingsMenu")},{default:Object(i["withCtx"])(()=>[Object(i["createVNode"])(l,{"delegate-management-options":e.delegateManagementOptions,"delegated-management":e.delegatedManagement},null,8,["delegate-management-options","delegated-management"])]),_:1},8,["content-title"])):Object(i["createCommentVNode"])("",!0),e.accountManagedByCurrentUser?(Object(i["openBlock"])(),Object(i["createBlock"])(s,{key:1,"content-title":e.translate("MobileMessaging_Settings_SMSProvider"),feature:"true"},{default:Object(i["withCtx"])(()=>[e.isSuperUser&&e.delegatedManagement?(Object(i["openBlock"])(),Object(i["createElementBlock"])("p",Oe,Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_DelegatedSmsProviderOnlyAppliesToYou")),1)):Object(i["createCommentVNode"])("",!0),Object(i["createVNode"])(c,{"credential-supplied":e.credentialSupplied,"credential-error":e.credentialError,provider:e.provider,"credit-left":e.creditLeft,"sms-provider-options":e.smsProviderOptions,"sms-providers":e.smsProviders},null,8,["credential-supplied","credential-error","provider","credit-left","sms-provider-options","sms-providers"])]),_:1},8,["content-title"])):Object(i["createCommentVNode"])("",!0),Object(i["createVNode"])(s,{"content-title":e.translate("MobileMessaging_PhoneNumbers")},{default:Object(i["withCtx"])(()=>[e.credentialSupplied?(Object(i["openBlock"])(),Object(i["createBlock"])(d,{key:1,"is-super-user":e.isSuperUser,"default-calling-code":e.defaultCallingCode,countries:e.countries,"str-help-add-phone":e.strHelpAddPhone,"phone-numbers":e.phoneNumbers},null,8,["is-super-user","default-calling-code","countries","str-help-add-phone","phone-numbers"])):(Object(i["openBlock"])(),Object(i["createElementBlock"])("p",Ne,Object(i["toDisplayString"])(e.accountManagedByCurrentUser?e.translate("MobileMessaging_Settings_CredentialNotProvided"):e.translate("MobileMessaging_Settings_CredentialNotProvidedByAdmin")),1))]),_:1},8,["content-title"]),Object(i["createElementVNode"])("div",Me,[Object(i["createElementVNode"])("h2",null,Object(i["toDisplayString"])(e.translate("MobileMessaging_Settings_DeleteAccountConfirm")),1),Object(i["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,fe),Object(i["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,Se)])])}var Ce=Object(i["defineComponent"])({props:{delegateManagementOptions:{type:Array,required:!0},delegatedManagement:[Number,Boolean],isSuperUser:Boolean,defaultCallingCode:String,countries:{type:Array,required:!0},strHelpAddPhone:{type:String,required:!0},phoneNumbers:Object,accountManagedByCurrentUser:Boolean,credentialSupplied:Boolean,credentialError:String,provider:String,creditLeft:[Number,String],smsProviderOptions:{type:Object,required:!0},smsProviders:{type:Object,required:!0}},components:{ContentBlock:g["ContentBlock"],DelegateMobileMessagingSettings:R,ManageMobilePhoneNumbers:ve,ManageSmsProvider:T}});Ce.render=ye;var Pe=Ce;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link    https://matomo.org
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=MobileMessaging.umd.min.js.map